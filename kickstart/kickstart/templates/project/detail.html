{% extends "base.html" %}
{% load i18n %}

{% block css %}
<style>
.project-container:after, .project-container .header:after {
  content: " ";
  visibility: hidden;
  display: block;
  height: 0;
  clear: both;
}
.project-container:after, .project-container .header:after {
  content: "";
  display: table;
  clear: both;
}
.project-container .header {
    margin-bottom: 10px;
    text-align: center;
}
.project-container .header > * {
    float: left;
}
.project-container .header .author {
    margin-right: 10px;
}
.project-container .column {
    float: left;
}
.project-container .left {
    width: 75%;
}
.project-container .right {
    width: 20%;
}
.tags {
    margin-top: 10px;
}
.amount, .donators {
    margin-bottom: 10px;
}
.benefit {
    margin-bottom: 10px;
}
.errors {
    color: red;
}
</style>

{% endblock css %}

{% block js %}
<script>
    $(document).ready(function(){
        $('.donation-form').submit(function(){
            var form = $(this);

            form.parsley('validate');
            if (form.parsley('isValid')) {
                $.post(form.attr('action'), form.serialize(), function(data){
                    if (data.success) {
                        document.location.reload(true);
                    }
                    else {
                        form.find('.errors').html(data.errors);
                    }
                });
            }

            return false;
        });
    });
</script>
{% endblock js %}

{% block content %}

<div class="project-container">
    <div class="column left">
        <div class="header">
            <div class="author">
                <img src="{{ project.user.profile.get_avatar }}"><br>
                <a href="{% url "profile" project.user.username %}" target="_blank">{{ project.user.username|capfirst }}</a>
            </div>
            <h1>{{ project.name }}</h1>
        </div>
        {{ project.desc|removetags:"script style iframe form"|safe }}
        <div class="tags">
            <b>{% trans "Tags" %}:</b>
            {% for tag in project.tags.all %}
                <a href="{% url "home" %}?search={{ tag.name }}">{{ tag.name }}</a>
            {% endfor %}
        </div>

        <h3>{% trans "Files" %}:</h3>
        <ol>
        {% for file in project.files.all %}
            <li><a href="{{ file.file.url }}">{{ file.original_filename }}</a></li>
        {% endfor %}
        </ol>

        {% if donation_form %}
            <h2>{% trans "Donate to this project" %}:</h2>
            <form action="{% url "project-donate" %}" class="donation-form" method="POST", parsley-validate>
                {% csrf_token %}
                {{ donation_form.project }}
                <b>{{ donation_form.benefit.label_tag }}</b>
                {{ donation_form.benefit }}
                <input type="submit" value="{% trans "Donate" %}">
                <div class="errors"></div>
              
            </form>
        {% endif %}
    </div>
    <dir class="column right">
        <b>{% trans "Donators" %}:</b>
        <div class="donators">{{ donations|length }}</div>

        <b>{% trans "Target amount" %}:</b>
        <div class="amount">{{ project.amount }} bucks</div>

        <b>{% trans "Collected amount" %}:</b>
        <div class="amount">{{ collected_amount }}</div>

        <div>{{ project.deadline|date:"jS F Y H:i T" }}</div>

        <h3>{% trans "benefits" %}:</h3>
        {% for benefit in project.benefits.all %}
            <div class="benefit">
                <b>{{ benefit.amount }}</b>. {{ benefit.text|linebreaksbr }}
            </div>
        {% endfor %}
    </dir>
</div>

{% endblock content %}
